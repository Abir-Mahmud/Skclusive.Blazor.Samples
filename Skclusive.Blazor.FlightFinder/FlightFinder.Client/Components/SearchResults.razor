@inherits ObservableComponentBase
@inject IAppState AppState
@inject IAppService AppService

<div class="px-4">
	@if (AppState.SearchResults.Any())
	{
		<div class="title">
			<h2 class="my-3">@AppState.SearchResults.Count results</h2>
			<select class="custom-select" @bind=chosenSortOrder>
				<option value=@SortOrder.Price>Cheapest</option>
				<option value=@SortOrder.Duration>Quickest</option>
			</select>
		</div>

		@foreach (var item in sortedSearchResults)
		{
            <SearchResult @key="item" Itinerary="@item" />
		}
	}
</div>

@code
{
	// Private state
	private SortOrder chosenSortOrder;

	private IEnumerable<IItinerary> sortedSearchResults
		=> chosenSortOrder == SortOrder.Price
		? AppState.SearchResults.OrderBy(x => x.Price)
		: AppState.SearchResults.OrderBy(x => x.TotalDurationHours);

	enum SortOrder { Price, Duration }

	private void AddToShortlist(IItinerary itinerary)
	{
		AppState.AddToShortlist(itinerary.GetSnapshot<IItinerarySnapshot>());
	}

    private bool IsShortlisted(IItinerary itinerary)
    {
        return AppState.Shortlist.Any(it => it.Id == itinerary.Id);
    }
}
